BASE=${1:-/var/tftpboot/NetBSD/7.0/i386}
set -e
mkdir -p ${BASE}
NS=8.8.8.8
if [ -s /usr/local/etc/dhcpd.conf ]
then
	set $(grep domain-name-servers /usr/local/etc/dhcpd.conf | sed -e "s/;//")
	NS=$3
fi
cat <<% > ${BASE}/etc/resolv.conf
search		$(domainname) k1.com.br
nameserver	$NS
%
cat <<% > ${BASE}/etc/rc.conf
#	: rc.conf,v 1.96 2000/10/14 17:01:29 wiz Exp $
#
# see rc.conf(5) for more information.
#
# Use program=YES to enable program, NO to disable it. program_flags are
# passed to the program on the command line.
#

# Load the defaults in from /etc/defaults/rc.conf (if it's readable).
# These can be overridden below.
#
if [ -r /etc/defaults/rc.conf ]; then
	. /etc/defaults/rc.conf
fi

# If this is not set to YES, the system will drop into single-user mode.
#
rc_configured=YES

# Add local overrides below
#
hostname=$(domainname)diskless.$(domainname)
domainname=$(domainname)
flushroutes=NO
no_swap=YES
smartd=YES
sshd=YES
ntpd=YES
wscons=YES
dbus=YES
hal=YES
gdm=YES
xdm=YES
ypbind=YES
lighttpd=YES
devpubd=YES
lockd=YES
statd=YES
rpcbind=YES
nfs_client=YES
nfs_server=NO
mountd=NO
sendmail=YES
saslauthd=YES
%
cat <<% > ${BASE}/etc/syslog.conf
#	$NetBSD: syslog.conf,v 1.9 2004/07/23 03:45:42 mycroft Exp $

*.*					@server
%

cat <<% > ${BASE}/var/cron/tabs/root
# DO NOT EDIT THIS FILE - edit the master and reinstall.
# (/tmp/crontab.qspJ0SpSrU installed on Wed Dec 21 07:52:42 2016)
# (Cron version V5.0 -- $NetBSD: crontab.c,v 1.7.10.1 2014/09/08 19:15:03 msaitoh Exp $)
#
SHELL=/bin/sh
PATH=/bin:/sbin:/usr/bin:/usr/sbin
HOME=/var/log
CRON_WITHIN=7200
#
#minute	hour	mday	month	wday	command
#
*	*	*	*	*	/usr/libexec/atrun
#
# rotate log files every hour, if necessary
#0	*	*	*	*	/usr/bin/newsyslog
#
# do daily/weekly/monthly maintenance
#15	3	*	*	*	/bin/sh /etc/daily 2>&1 | tee /var/log/daily.out | sendmail -t
#30	4	*	*	6	/bin/sh /etc/weekly 2>&1 | tee /var/log/weekly.out | sendmail -t
#30	5	1	*	*	/bin/sh /etc/monthly 2>&1 | tee /var/log/monthly.out | sendmail -t
%
cd ${BASE}/etc/rc.d

for i in diskless ypbind
do
	curl http://dist64.k1.com.br/Downloads/NetBSD/diskless/etc/rc.d/$i -o $i
	chmod 755 $i
done
cd ..
curl http://dist64.k1.com.br/Downloads/NetBSD/diskless/etc/passwd.conf -o passwd.conf

echo DISKLESS CONFIGURE OK
